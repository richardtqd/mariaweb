<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html" 
                xmlns:p="http://primefaces.org/ui" 
                template="/plantilla/plantillaPrincipal.xhtml"
                xmlns:c="http://java.sun.com/jsp/jstl/core">
    <ui:define name="content">
        <h:body> 
            <p:layout id="layEst" fullPage="false"  style="width:1300px;height:750px" styleClass="centrado"> 
                <p:layoutUnit position="west" size="480" header="Configuracion de Esquela" resizable="false" closable="false" collapsible="false" effect="drop" collapsed="false" effectSpeed="500" >
                    <h:panelGrid style="margin: 0 auto;" > 
                        <h:form id="frmTblMatri">
                            <br></br>
                            <h:panelGrid  id="pnlTablaFiltroNoMatri" style="width: 400px" styleClass="centrado">
                                <p:fieldset  styleClass="centrado" toggleable="true" toggleSpeed="500" collapsed="false" legend="#{msgs.etiquetaFiltros}"   >
                                    <h:panelGrid columns="1"  > 
                                        <h:panelGrid columns="2">
                                            <h:outputLabel value="#{msgs.etiquetaPeriodo}: " class="negrita siseFontGrid5" /> 
                                            <p:spinner id="minMax" value="#{detEsquelaMB.matriculaFiltroBean.anioIni}" min="#{msgs.anioIniEst}" max="#{msgs.anioFinEst}" label="#{msgs.etiquetaPeriodo}" size="1">
                                                <p:ajax event="change" listener="#{detEsquelaMB.obtenerAnioMat()}" />
                                            </p:spinner>
                                        </h:panelGrid>
                                        <h:panelGrid columns="2" >
                                            <h:outputLabel value="Tipo de Envio: " />
                                            <p:selectOneMenu value="#{detEsquelaMB.esquelaBean.tipoEsquelaBean.idCodigo}" required="true" label="Tipo de Envio">
                                                <f:selectItem itemValue="#{null}" itemLabel="#{msgs.etiquetaSeleccionar}" noSelectionOption="true"/>
                                                <f:selectItems value="#{esquelaMB.listaTipoEsquelaBean}" var="tipoEsquela" itemValue="#{tipoEsquela.idCodigo}" itemLabel="#{tipoEsquela.valor}" />
                                                <p:ajax listener="#{detEsquelaMB.activarMeses()}" update=":frmTblMatri,:frmMsgEsquela2" />
                                            </p:selectOneMenu>
                                        </h:panelGrid>
                                        <h:panelGrid id="pnlTodos" columns="2">
                                            <p:selectBooleanCheckbox id="ckTodos" value="#{detEsquelaMB.flgTodos}" class="titulo" required="true" > 
                                                <p:ajax event="change" update="pnlEstSinPro,pnlNivelGradoAca,pnlEstEsp" listener="#{detEsquelaMB.verificarFiltroTodos()}"/>
                                            </p:selectBooleanCheckbox>
                                            <h:outputText value="#{msgs.etiquetaTodos}"/> 
                                            <p:message for="ckTodos" showDetail="true" />
                                        </h:panelGrid> 
                                        <h:panelGrid id="pnlEstSinPro" columns="2">

                                        </h:panelGrid>  
                                        <h:panelGrid id="pnlEstEsp" columns="3">
                                            <h:panelGrid columns="2" width="180">
                                                <p:selectBooleanCheckbox  value="#{detEsquelaMB.flgEstEsp}" class="titulo" required="true" > 
                                                    <p:ajax event="change" update="pnlTodos,pnlEstSinPro,pnlNivelGradoAca,pnlEstEsp" listener="#{detEsquelaMB.verificarFiltroEstEsp()}"/>
                                                </p:selectBooleanCheckbox>
                                                <h:outputLabel value="#{msgs.etiquetaEstEspecifico}:" class="titulo" />
                                            </h:panelGrid>
                                            <p:spacer width="5" rendered="#{detEsquelaMB.flgEstEsp==true}"/>
                                            <p:panel rendered="#{detEsquelaMB.flgEstEsp==true}">  
                                                <h:panelGrid columns="2" class="siseFont1" width="350"> 
                                                    <h:outputLabel value="#{msgs.EtiquetaCodigo}" class="negrita siseFont5" rendered="#{detEsquelaMB.flgEstEsp==true}" /> 
                                                    <p:inputText  value="#{detEsquelaMB.matriculaFiltroBean.estudianteBean.personaBean.idPersona}" label="#{msgs.EtiquetaCodigo}" readonly="false" size="15" rendered="#{detEsquelaMB.flgEstEsp==true}"/> 
                                                    <h:outputLabel value="#{msgs.etiquetaApePat}" class="negrita siseFont5" rendered="#{detEsquelaMB.flgEstEsp==true}"/>
                                                    <p:inputText value="#{detEsquelaMB.matriculaFiltroBean.estudianteBean.personaBean.apepat}" label="#{msgs.etiquetaApePat}" size="28" maxlength="30" rendered="#{detEsquelaMB.flgEstEsp==true}" />  
                                                    <h:outputLabel value="#{msgs.etiquetaApeMat}" class="negrita siseFont5" rendered="#{detEsquelaMB.flgEstEsp==true}" />
                                                    <p:inputText value="#{detEsquelaMB.matriculaFiltroBean.estudianteBean.personaBean.apemat}" label="#{msgs.etiquetaApeMat}" size="28" maxlength="30" rendered="#{detEsquelaMB.flgEstEsp==true}"/> 
                                                    <h:outputLabel value="#{msgs.etiquetaNombre}" class="negrita siseFont5" rendered="#{detEsquelaMB.flgEstEsp==true}"/>
                                                    <p:inputText value="#{detEsquelaMB.matriculaFiltroBean.estudianteBean.personaBean.nombre}" label="#{msgs.etiquetaNombre}" size="28" maxlength="30" rendered="#{detEsquelaMB.flgEstEsp==true}" />  
                                                </h:panelGrid>
                                            </p:panel>
                                        </h:panelGrid>  
                                        <h:panelGrid id="pnlNivelGradoAca" columns="3" >
                                            <h:panelGrid columns="2" width="150">
                                                <p:selectBooleanCheckbox  value="#{detEsquelaMB.flgPorNivelGrado}" class="titulo" required="true" > 
                                                    <p:ajax event="change" update="pnlNivelGradoAca,pnlTodos,pnlEstSinPro,pnlEstEsp" listener="#{detEsquelaMB.verificarFiltroNivelGrado()}" />
                                                </p:selectBooleanCheckbox>
                                                <h:outputText value="#{msgs.etiquetaPorNivelGrado}"/> 
                                            </h:panelGrid> 
                                            <p:spacer width="45" rendered="#{detEsquelaMB.flgPorNivelGrado==true}"/>
                                            <p:panel rendered="#{detEsquelaMB.flgPorNivelGrado==true}">  
                                                <h:panelGrid columns="2" width="300">
                                                    <h:outputLabel value="#{msgs.etiquetaNivelAcademico}" class="titulo" rendered="#{detEsquelaMB.flgPorNivelGrado==true}" /> 
                                                    <p:selectOneMenu value="#{detEsquelaMB.matriculaFiltroBean.estudianteBean.gradoHabilitado.nivelAcademicoBean.idNivelAcademico}" style="width:160px" panelStyle="width:160px" label="#{msgs.etiquetaNivelAcademico}" rendered="#{detEsquelaMB.flgPorNivelGrado==true}" >
                                                        <f:selectItem itemValue="#{null}" itemLabel="#{msgs.comboSeleccionarLabel}" noSelectionOption="true"/>
                                                        <f:selectItems value="#{detEsquelaMB.listaNivelAcademico}" var="nivAca" itemLabel="#{nivAca.nombre}" itemValue="#{nivAca.idNivelAcademico}"/> 
                                                        <p:ajax event="change" listener="#{detEsquelaMB.obtenerGradoAcaBasica()}" update="cmboGradoAcaBas" />
                                                    </p:selectOneMenu>     
                                                    <h:outputLabel value="#{msgs.etiquetaGradoAca}" class="titulo" rendered="#{detEsquelaMB.flgPorNivelGrado==true}"  /> 
                                                    <p:selectOneMenu id="cmboGradoAcaBas" value="#{detEsquelaMB.matriculaFiltroBean.estudianteBean.gradoHabilitado.idGradoAcademico}" style="width:160px" panelStyle="width:160px" class="resetSelect" label="#{msgs.etiquetaGradoAca}" rendered="#{detEsquelaMB.flgPorNivelGrado==true}">
                                                        <f:selectItem itemValue="#{null}" itemLabel="#{msgs.comboSeleccionarLabel}" noSelectionOption="true"/>
                                                        <f:selectItems value="#{detEsquelaMB.listaGradoAcademicoFiltroBean}" var="GradAcaBas" itemLabel="#{GradAcaBas.nombre}" itemValue="#{GradAcaBas.idGradoAcademico}"/>
                                                    </p:selectOneMenu>  
                                                </h:panelGrid> 
                                            </p:panel> 
                                        </h:panelGrid>   
                                    </h:panelGrid> 
                                    <h:panelGrid styleClass="centrado" columns="2">
                                        <p:commandButton value="#{msgs.botonBuscar}" action="#{detEsquelaMB.obtenerFiltroEstudianteMasivo()}" update="pnlTablaMatricula,msg"/>
                                        <p:commandButton value="#{msgs.botonLimpiar}" action="#{detEsquelaMB.limpiarEstudianteMatriculaMasivo()}" update="pnlTablaFiltroNoMatri,pnlTablaMatricula,msg" rendered="false"/>
                                    </h:panelGrid> 
                                    <p:messages autoUpdate="false" id="msg" closable="true"/>
                                </p:fieldset>
                                <p:fieldset styleClass="centrado" toggleable="true" toggleSpeed="500" collapsed="false" legend="#{msgs.etiquetaSeleccionar}" >
                                    <h:panelGrid columns="1" >
                                        <h:panelGrid id="pnlFlgPapa" columns="2" >
                                            <p:selectBooleanCheckbox  value="#{detEsquelaMB.flgPa}" class="titulo" required="true" label="#{msgs.etiquetaPad}" >  
                                                <p:ajax event="change" update="pnlFlgPapa,pnlFlgMama,pnlFlgApod,pnlFlgResPag,:frmMsgEsquela2" listener="#{detEsquelaMB.cambiarEstado1()}"/>
                                            </p:selectBooleanCheckbox>
                                            <h:outputText value="#{msgs.etiquetaPad}"/> 
                                        </h:panelGrid>
                                        <h:panelGrid id="pnlFlgMama" columns="2" >
                                            <p:selectBooleanCheckbox  value="#{detEsquelaMB.flgMa}" class="titulo" required="true" label="#{msgs.etiquetaMad}" > 
                                                <p:ajax event="change" update="pnlFlgPapa,pnlFlgMama,pnlFlgApod,pnlFlgResPag,:frmMsgEsquela2" listener="#{detEsquelaMB.cambiarEstado2()}"/>
                                            </p:selectBooleanCheckbox>
                                            <h:outputText value="#{msgs.etiquetaMad}"/>
                                        </h:panelGrid>
                                        <h:panelGrid id="pnlFlgApod" columns="2" >
                                            <p:selectBooleanCheckbox  value="#{detEsquelaMB.flgAp}" class="titulo" required="true" label="#{msgs.etiquetaApoderado}" > 
                                                <p:ajax event="change" update="pnlFlgPapa,pnlFlgMama,pnlFlgApod,pnlFlgResPag,:frmMsgEsquela2" listener="#{detEsquelaMB.cambiarEstado3()}"/>
                                            </p:selectBooleanCheckbox>
                                            <h:outputText value="#{msgs.etiquetaApoderado}"/>
                                        </h:panelGrid> 
                                        <h:panelGrid id="pnlFlgResPag" columns="2" >
                                            <p:selectBooleanCheckbox  value="#{detEsquelaMB.flgResPa}" class="titulo" required="true" label="#{msgs.etiquetaResPago}" > 
                                                <p:ajax event="change" update="pnlFlgPapa,pnlFlgMama,pnlFlgApod,pnlFlgResPag,:frmMsgEsquela2" listener="#{detEsquelaMB.cambiarEstado4()}"/>
                                            </p:selectBooleanCheckbox>
                                            <h:outputText value="#{msgs.etiquetaResPago}"/>
                                        </h:panelGrid>
                                    </h:panelGrid>
                                </p:fieldset> 
                                <p:fieldset styleClass="centrado" toggleable="true" toggleSpeed="500" collapsed="false" legend="#{msgs.etiquetaSeleccionar} #{msgs.etiquetaMes}" rendered="#{detEsquelaMB.envio}"> 
                                    <p:selectManyCheckbox id="meses" value="#{detEsquelaMB.listaMeses}" layout="grid" columns="3"> 
                                        <f:selectItems value="#{detEsquelaMB.listaMesesExpMap}" var="mes" itemValue="#{mes}"  />
                                        <p:ajax listener="#{detEsquelaMB.filtrarMes}" process="@this" update="pnlTablaMatricula" />
                                    </p:selectManyCheckbox> 
                                </p:fieldset>  
                            </h:panelGrid>
                            <h:panelGrid  id="pnlTablaMatricula" styleClass="centrado" > 
                                <p:dataTable id="tblMatricula" value="#{detEsquelaMB.listaMatriculaEstudiantesMasivosBean}" widgetVar="tblMatricula"
                                             paginator="true" selectionMode="single" 
                                             selection="#{detEsquelaMB.matriculaBean}" rowIndexVar="n" 
                                             var="estudiante" rowKey="#{estudiante}" paginatorPosition="bottom"
                                             rows="#{detEsquelaMB.numRegistrosTablasPorFiltroMin}" 
                                             rendered="#{not empty detEsquelaMB.listaMatriculaEstudiantesMasivosBean}" 
                                             style="width:700px; font-size: 10px;font-size:14px !important;"> 
                                    <f:facet name="header" >
                                        <h:outputText value="#{msgs.etiquetaEstPosNoMatri}" />   
                                    </f:facet>
                                    <p:column  headerText="N" filterMatchMode="contains" width="4%" styleClass="siseFontTable3 centrado-texto">
                                        <center>
                                            <h:outputText value="#{n+1}" />
                                        </center>
                                    </p:column>
                                    <p:column headerText="#{msgs.etiquetaCodigo}" filterMatchMode="contains" width="8%" styleClass="siseFontTable3 centrado-texto" sortBy="#{estudiante.estudianteBean.personaBean.idPersona}" >
                                        <h:outputText value="#{estudiante.estudianteBean.personaBean.idPersona}"/>
                                    </p:column>
                                    <p:column headerText="#{msgs.etiquetaNombreCompleto}" filterMatchMode="contains" width="20%" styleClass="siseFontTable3 " sortBy="#{estudiante.estudianteBean.personaBean.idPersona}" >
                                        <h:outputText value="#{estudiante.estudianteBean.personaBean.nombreCompleto}"/>
                                    </p:column>
                                    <p:column headerText="#{msgs.etiquetaGraAct}" filterMatchMode="contains" width="10%" styleClass="siseFontTable3 centrado-texto" sortBy="#{estudiante.estudianteBean.gradoHabilitado.nombre}" >
                                        <h:outputText value="#{estudiante.estudianteBean.gradoHabilitado.nombre}"/>
                                    </p:column>
                                    <p:column headerText="#{msgs.etiquetaSeccAbr}" filterMatchMode="contains" width="5%" styleClass="siseFontTable3 centrado-texto" sortBy="#{estudiante.seccion}" >
                                        <h:outputText value="#{estudiante.seccion}"/>
                                    </p:column>
                                    <c:if test="#{detEsquelaMB.matriculaFiltroBean.dato == 1}" >
                                        <p:column headerText="#{msgs.etiquetaAcci}" filterMatchMode="contains" width="5%" styleClass="siseFontTable3 centrado-texto" >
                                            <p:commandLink id="cmdDeuda" actionListener="#{detEsquelaMB.obtenerDeudaEst(estudiante)}" update=":frmPopDeuda:pnlPopDeuda" process="@this"
                                                           oncomplete="PF('popDeuda').show()">
                                                <h:graphicImage value="/resources/images/icons/search2.png" />
                                            </p:commandLink>
                                            <p:tooltip value="#{msgs.etiquetaSeleccionar}" for="cmdDeuda" />
                                        </p:column>
                                    </c:if> 
                                </p:dataTable>
                                <br></br>
                            </h:panelGrid>
                        </h:form>
                    </h:panelGrid>
                </p:layoutUnit>
                <p:layoutUnit position="center" styleClass="centrado"> 
                    <h:form id="frmMsgEsquela2" >
                        <p:tabView id="tabDetEsq" dynamic="true" cache="true"  styleClass="centrado" scrollable="true" >
                            <p:ajax event="tabChange" listener="#{detEsquelaMB.obtenerMenUniNeg()}" update=":frmMsgEsquela2:tabDetEsq:pnlDetEsqMen" />
                            <p:tab title="#{msgs.botonNuevo}">
                                <h:panelGrid id="pnlDetEsq" styleClass="centrado" >
                                    <h:panelGrid columns="2" >
                                        <p:outputLabel value="#{msgs.etiquetaSeleccionar} #{msgs.etiquetaAcci}" />
                                        <p:selectOneRadio id="console" value="#{detEsquelaMB.esquelaBean.tipoAccion}">
                                            <f:selectItem itemLabel="#{msgs.etiquetaEnvCor}" itemValue="1" />
                                            <f:selectItem itemLabel="#{msgs.etiquetaEnvImp}" itemValue="2" />
                                            <p:ajax event="change" listener="#{detEsquelaMB.obtenerTextArea()}" 
                                                    update=":frmMsgEsquela2:tabDetEsq" process="@this"/>
                                        </p:selectOneRadio>
                                    </h:panelGrid>
                                    <h:panelGrid styleClass="centrado" >
                                        <p:inputText value="#{detEsquelaMB.esquelaBean.titulo}" placeholder="#{msgs.etiquetaTituloEsq}" style="width: 750px;" />
                                        <br/>
                                        <p:editor id="textEnv" value="#{detEsquelaMB.esquelaBean.mensaje}" widgetVar="editorWidget" onchange="saveHtml();" height="350" width="750" 
                                                  rendered="#{detEsquelaMB.esquelaBean.tipoAccion == 1}" /> 
                                        <p:inputTextarea id="textImp" value="#{detEsquelaMB.esquelaBean.mensaje}" rows="20" cols="95" required="true" label="#{msgs.etiquetaMensaje}" 
                                                         rendered="#{detEsquelaMB.esquelaBean.tipoAccion == 2}"/>
                                    </h:panelGrid>
                                    <bd/><br/>
                                    <h:panelGrid columns="2" styleClass="centrado" >
                                        <p:commandButton value="#{msgs.botonEnviar}" actionListener="#{detEsquelaMB.guardar()}" oncomplete="if(args.operacionCorrecta){PF('popMsgEsquela').show();}"
                                                         update=":frmMsgEsquela2:tabDetEsq:pnlDetEsq,:frmMsgEsquela2:tabDetEsq:msgDetEsq,
                                                         :frmMsgEsquela:pnlMsgEsquela" rendered="#{detEsquelaMB.esquelaBean.tipoAccion == 1}"/>
                                        <p:commandButton value="#{msgs.botonLimpiar}" actionListener="#{detEsquelaMB.limpiarEsquela()}" 
                                                         update=":frmTblMatri:pnlTablaFiltroNoMatri,:frmTblMatri:pnlTablaMatricula,:frmTblMatri:msg,
                                                         :frmMsgEsquela2:tabDetEsq:pnlDetEsq,:frmTblMatri:meses" />
                                        <h:commandLink id="cmdImp" action="#{detEsquelaMB.imprimir()}" target="_blank" rendered="#{detEsquelaMB.esquelaBean.tipoAccion == 2}">
                                            <h:graphicImage value="/resources/images/icons/pdf.png" />
                                        </h:commandLink>
                                    </h:panelGrid>
                                    <p:messages id="msgDetEsq" showDetail="true" />
                                </h:panelGrid>
                            </p:tab>
                            <p:tab title="#{msgs.etiquetaEnvios}s"  >
                                <h:panelGrid id="pnlDetEsqMen" columns="2" cellpadding="10"> 
                                    <p:dataTable value="#{detEsquelaMB.listaEsquelaBean}" var="det" 
                                                 paginator="true" paginatorPosition="bottom"
                                                 selection="#{detEsquelaMB.detEsquelaBean}" rowIndexVar="n"
                                                 rendered="#{not empty detEsquelaMB.listaEsquelaBean}"
                                                 rowKey="#{det}" rows="20">
                                        <f:facet name="header" >
                                            <p:outputLabel value="#{msgs.etiquetaDatosGenerales}" />
                                        </f:facet>
                                        <p:column headerText="#{msgs.etiquetaTitulo}" filterMatchMode="contains" width="2%" styleClass="siseFontTable3 centrado-texto">
                                            <h:outputText value="#{det.titulo}" />
                                        </p:column>
                                        <p:column headerText="#{msgs.etiquetaDestino}" filterMatchMode="contains" width="2%" styleClass="siseFontTable3 centrado-texto">
                                            <h:outputText value="#{det.destino}" escape="false" />
                                        </p:column>
                                        <p:column headerText="#{msgs.etiquetaTotalEnvioOk}" filterMatchMode="contains" width="2%" styleClass="siseFontTable3 centrado-texto" >
                                            <h:outputText value="#{det.numOk}" /> 
                                        </p:column>
                                        <p:column headerText="#{msgs.etiquetaTotalEnvioFa}" filterMatchMode="contains" width="2%" styleClass="siseFontTable3 centrado-texto" >
                                            <h:outputText value="#{det.numFa}" /> 
                                        </p:column>
                                        <p:column headerText="#{msgs.etiquetaTotalEnvio}" filterMatchMode="contains" width="2%" styleClass="siseFontTable3 centrado-texto" >
                                            <h:outputText value="#{det.num}" /> 
                                        </p:column>
                                        <p:column headerText="#{msgs.etiquetaFechaEnvio}" filterMatchMode="contains" width="2%" styleClass="siseFontTable3 centrado-texto" >
                                            <h:outputText value="#{det.creaFecha}" >
                                                <f:convertDateTime pattern="dd-MM-yyyy" />
                                            </h:outputText> 
                                        </p:column>
                                        <p:column headerText="#{msgs.etiquetaAcci}" filterMatchMode="contains" width="1%" styleClass="siseFontTable3 centrado-texto" >
                                            <p:commandLink id="btnPdf" actionListener="#{detEsquelaMB.obtenerDetallesEsquela(det)}" 
                                                           update=":frmDetMsg:tabDetMsgEsq" oncomplete="PF('popMsgEsquelaDet').show();" >
                                                <h:graphicImage value="/resources/images/icons/search2.png" />
                                            </p:commandLink>
                                            <p:tooltip for="btnPdf" value="#{msgs.etiquetaVer}" />
                                        </p:column>
                                    </p:dataTable>
                                </h:panelGrid>
                            </p:tab> 
                        </p:tabView>
                        <p:messages id="msgRem" showDetail="true" closable="true"   />
                    </h:form>  
                </p:layoutUnit>
            </p:layout>

            <p:dialog id="popMsgEsquela" header="#{msgs.appTitulo}" widgetVar="popMsgEsquela" showEffect="fade" hideEffect="explode"  resizable="false" modal="true" >
                <h:form id="frmMsgEsquela" >
                    <h:panelGrid columns="2">
                        <h:graphicImage value="/resources/images/icons/iconoPregunta.png"/>
                        <h:panelGrid>
                            <h:outputText value="#{msgs.etiquetaConfMen}"/> 
                        </h:panelGrid>
                    </h:panelGrid>
                    <br/>
                    <h:panelGrid columns="4" class="centrado">
                        <p:commandButton id="btnEnv" value="#{msgs.etiquetaEnv}" actionListener="#{detEsquelaMB.insertarEnvioMasivo(1)}"
                                         styleClass="ui-confirmdialog-yes"
                                         oncomplete="if(args.operacionCorrecta){PF('popMsgEsquela').hide();PF('popDone').show();}"
                                         update=":frmTblMatri:pnlTablaFiltroNoMatri,:frmTblMatri:pnlTablaMatricula,:frmTblMatri:msg,
                                         :frmMsgEsquela2:tabDetEsq:pnlDetEsq,:frmTblMatri:meses" />
                        <p:commandButton value="#{msgs.etiquetaNoEnv}" styleClass="ui-confirmdialog-no" 
                                         oncomplete="PF('popMsgEsquela').hide();"/>
                        <p:commandButton value="#{msgs.botonCerrar}" actionListener="#{detEsquelaMB.limpiarEsquela()}" 
                                         update=":frmTblMatri:pnlTablaFiltroNoMatri,:frmTblMatri:pnlTablaMatricula,:frmTblMatri:msg,
                                         :frmMsgEsquela2:tabDetEsq:pnlDetEsq,:frmTblMatri:meses" oncomplete="PF('popMsgEsquela').hide();"/>
                    </h:panelGrid>
                    <br/>
                    <p:fieldset legend="#{msgs.etiquetaMensaje}" style="width: 400px;" rendered="false" >
                        <h:panelGrid id="pnlMsgEsquela" styleClass="centrado">
                            <h:outputText value="#{detEsquelaMB.esquelaBean.titulo}" />
                            <br/>
                            <h:outputText value="#{detEsquelaMB.esquelaBean.mensaje}" escape="false"/>
                        </h:panelGrid> 
                    </p:fieldset>
                </h:form>
            </p:dialog>

            <p:dialog header="#{msgs.appTitulo}" width="1200" widgetVar="popMsgEsquelaDet" showEffect="fade" hideEffect="explode"  resizable="false" modal="true" closeOnEscape="true">
                <h:form id="frmDetMsg" >
                    <p:tabView id="tabDetMsgEsq" dynamic="true" cache="true"  styleClass="centrado" scrollable="true" style="width: 1000px;" >
                        <p:tab title="#{msgs.etiquetaTotalEnviCor}" rendered="#{not empty detEsquelaMB.listaDetEsquelaOkBean}" >
                            <p:dataTable value="#{detEsquelaMB.listaDetEsquelaOkBean}" var="detOk" 
                                         paginator="true"  paginatorPosition="bottom" style="width: 900px;"
                                         selection="#{detEsquelaMB.detEsquelaBean}" rowIndexVar="n"
                                         rendered="#{not empty detEsquelaMB.listaDetEsquelaOkBean}"
                                         rowKey="#{detOk}" rows="#{detEsquelaMB.numRegistrosTablasPorFiltroMin}" >
                                <f:facet name="header" >
                                    <p:outputLabel value="#{msgs.etiquetaDatosGenerales}" />
                                </f:facet>
                                <p:column headerText="#{msgs.etiquetaCodigoAlumno}" filterMatchMode="contains" width="3%" styleClass="siseFontTable2 centrado-texto">
                                    <h:outputText value="#{detOk.estudianteBean.idEstudiante}" />
                                </p:column>
                                <p:column headerText="#{msgs.etiquetaNombre}" filterMatchMode="contains" width="3%" styleClass="siseFontTable2 centrado-texto">
                                    <h:outputText value="#{detOk.estudianteBean.personaBean.nombre}" />
                                </p:column>
                                <p:column headerText="#{msgs.etiquetaApellidos}" filterMatchMode="contains" width="3%" styleClass="siseFontTable2 centrado-texto">
                                    <h:outputText value="#{detOk.estudianteBean.personaBean.apepat} #{detOk.estudianteBean.personaBean.apemat}" />
                                </p:column>
                                <p:column headerText="#{msgs.etiquetaCorreo}" filterMatchMode="contains" width="3%" styleClass="siseFontTable2 centrado-texto">
                                    <h:outputText value="#{detOk.estudianteBean.personaBean.correo}" />
                                </p:column>
                                <p:column headerText="#{msgs.etiquetaDestino}" filterMatchMode="contains" width="3%" styleClass="siseFontTable2 centrado-texto">
                                    <h:outputText value="#{detOk.destino}" />
                                </p:column> 
                                <p:column headerText="#{msgs.etiquetaNombres} #{msgs.etiquetaDestino}" filterMatchMode="contains" width="3%" styleClass="siseFontTable2 centrado-texto">
                                    <h:outputText value="#{detOk.destinoPer}" />
                                </p:column>
                                <p:column headerText="#{msgs.etiquetaCorreo} #{msgs.etiquetaDestino}" filterMatchMode="contains" width="3%" styleClass="siseFontTable2 centrado-texto">
                                    <h:outputText value="#{detOk.correo}" />
                                </p:column>
                            </p:dataTable>
                        </p:tab>
                        <p:tab title="#{msgs.etiquetaTotalEnviNoCor}" rendered="#{not empty detEsquelaMB.listaDetEsquelaFailBean}" >
                            <p:dataTable value="#{detEsquelaMB.listaDetEsquelaFailBean}" var="detFail" 
                                         rendered="#{not empty detEsquelaMB.listaDetEsquelaFailBean}"
                                         paginator="true" paginatorPosition="bottom" style="width: 900px;"
                                         selection="#{detEsquelaMB.detEsquelaBean}" rowIndexVar="n"
                                         rowKey="#{detFail}" rows="#{detEsquelaMB.numRegistrosTablasPorFiltroMin}">
                                <f:facet name="header" >
                                    <p:outputLabel value="#{msgs.etiquetaDatosGenerales}" />
                                </f:facet>
                                <p:column headerText="#{msgs.etiquetaCodigoAlumno}" filterMatchMode="contains" width="3%" styleClass="siseFontTable2 centrado-texto">
                                    <h:outputText value="#{detFail.estudianteBean.idEstudiante}" />
                                </p:column>
                                <p:column headerText="#{msgs.etiquetaNombre}" filterMatchMode="contains" width="3%" styleClass="siseFontTable2 centrado-texto">
                                    <h:outputText value="#{detFail.estudianteBean.personaBean.nombre}" />
                                </p:column>
                                <p:column headerText="#{msgs.etiquetaApellidos}" filterMatchMode="contains" width="3%" styleClass="siseFontTable2 centrado-texto">
                                    <h:outputText value="#{detFail.estudianteBean.personaBean.apepat} #{detFail.estudianteBean.personaBean.apemat}" />
                                </p:column>
                                <p:column headerText="#{msgs.etiquetaCorreo}" filterMatchMode="contains" width="3%" styleClass="siseFontTable2 centrado-texto">
                                    <h:outputText value="#{detFail.estudianteBean.personaBean.correo}" />
                                </p:column> 
                                <p:column headerText="#{msgs.etiquetaDestino}" filterMatchMode="contains" width="5%" styleClass="siseFontTable2 centrado-texto">
                                    <h:outputText value="#{detFail.destino}" />
                                </p:column> 
                                <p:column headerText="#{msgs.etiquetaNombres} #{msgs.etiquetaDestino}" filterMatchMode="contains" width="5%" styleClass="siseFontTable2 centrado-texto">
                                    <h:outputText value="#{detFail.destinoPer}" />
                                </p:column>
                                <p:column headerText="#{msgs.etiquetaCorreo} #{msgs.etiquetaDestino}" filterMatchMode="contains" width="5%" styleClass="siseFontTable2 centrado-texto">
                                    <h:outputText value="#{detFail.correo}" />
                                </p:column>
                            </p:dataTable>
                        </p:tab>
                    </p:tabView>
                </h:form>
            </p:dialog>

            <h:form>
                <p:dialog header="#{msgs.appSiglas}" widgetVar="popError" width="370" height="120" showEffect="fade" hideEffect="explode"
                          modal="true">
                    <h:graphicImage value="/resources/images/icons/iconoInfo.png" />
                    <h:outputText value="Error de Envio"/>
                    <br/><br/>
                    <div align="center">
                        <p:commandButton oncomplete="PF('popError').hide();" 
                                         value="#{msgs.botonCerrar}" >
                        </p:commandButton>
                    </div>
                </p:dialog>
            </h:form>


            <p:dialog id="popMsgEsquela3" widgetVar="popMsgEsquela3" showEffect="fade" hideEffect="explode"  resizable="false" modal="true" width="800px" closeOnEscape="true">
                <p:fieldset legend="#{msgs.etiquetaMensaje}" styleClass="centrado" toggleable="true" toggleSpeed="500" collapsed="false" >
                    <h:form id="frmMsgEsquela3" > 
                        <h:panelGrid id="pnlMsgEsquela3" style="margin: 0 auto;">
                            <h:outputText value="#{detEsquelaMB.detEsquelaFiltroBean.esquelaBean.mensaje}" escape="false"/>
                        </h:panelGrid>
                    </h:form>
                </p:fieldset> 
                <h:form id="frmMatriculaFail">
                    <p:tabView id="tabMsgDeta" >
                        <p:tab title="#{msgs.etiquetaCorrectos}" >
                            <h:panelGrid id="pnlMatriculaFail" style="margin: 0 auto;" >
                                <p:dataTable id="tblMatriculaOk" value="#{detEsquelaMB.listaMatriculaEstudiantesMasivosBeanOk}" widgetVar="tblMatricula"
                                             paginator="true"  rows="5" 
                                             selection="#{detEsquelaMB.matriculaBean}" rowIndexVar="n" 
                                             var="estudianteOk" rowKey="#{estudianteOk}" paginatorPosition="bottom" 
                                             rendered="#{not empty detEsquelaMB.listaMatriculaEstudiantesMasivosBeanOk}" 
                                             style="width:600px; font-size: 10px;font-size:14px !important;"> 
                                    <f:facet name="header" >
                                        <h:outputText value="Envio Correctos" />  
                                        <h:commandLink id="cmdImMen" style="float: right;" action="#{detEsquelaMB.imprimirOk()}" target="_blank">
                                            <h:graphicImage value="/resources/images/icons/pdf.png" height="15" />
                                        </h:commandLink>
                                        <p:tooltip for="cmdImMen" value="#{msgs.etiquetaImprimir}" />
                                    </f:facet>
                                    <p:column  headerText="N" filterMatchMode="contains" width="4%" styleClass="siseFontTable3 centrado-texto">
                                        <center>
                                            <h:outputText value="#{n+1}" />
                                        </center>
                                    </p:column>
                                    <p:column headerText="#{msgs.etiquetaCodigo}" filterMatchMode="contains" width="8%" styleClass="siseFontTable3 centrado-texto" sortBy="#{estudiante.estudianteBean.personaBean.idPersona}" >
                                        <h:outputText value="#{estudianteOk.estudianteBean.personaBean.idPersona}"/>
                                    </p:column>
                                    <p:column headerText="#{msgs.etiquetaNombreCompleto}" filterMatchMode="contains" width="20%" styleClass="siseFontTable3 " sortBy="#{estudiante.estudianteBean.personaBean.idPersona}" >
                                        <h:outputText value="#{estudianteOk.estudianteBean.personaBean.nombreCompleto}"/>
                                    </p:column>
                                    <p:column headerText="#{msgs.etiquetaGraAct}" filterMatchMode="contains" width="10%" styleClass="siseFontTable3 centrado-texto" sortBy="#{estudiante.estudianteBean.gradoHabilitado.nombre}" >
                                        <h:outputText value="#{estudianteOk.estudianteBean.gradoHabilitado.nombre}"/>
                                    </p:column>
                                    <p:column headerText="#{msgs.etiquetaSeccAbr}" filterMatchMode="contains" width="5%" styleClass="siseFontTable3 centrado-texto" sortBy="#{estudiante.seccion}" >
                                        <h:outputText value="#{estudianteOk.seccion}"/>
                                    </p:column> 
                                    <p:column headerText="#{msgs.etiquetaNro} #{msgs.etiquetaEnvios}s" filterMatchMode="contains" width="5%" styleClass="siseFontTable3 centrado-texto" >
                                        <h:outputText value="#{estudianteOk.cont}" />
                                    </p:column>
                                </p:dataTable>
                            </h:panelGrid>
                        </p:tab>
                        <p:tab title="#{msgs.etiquetaErroneos}" >
                            <h:panelGrid id="pnlMatriculaOk" style="margin: 0 auto;">
                                <p:dataTable id="tblMatriculaFail" value="#{detEsquelaMB.listaMatriculaEstudiantesMasivosBeanFail}" widgetVar="tblMatricula"
                                             paginator="true" rows="5" 
                                             selection="#{detEsquelaMB.matriculaBean}" rowIndexVar="n" 
                                             var="estudianteFail" rowKey="#{estudianteFail}" paginatorPosition="bottom" 
                                             rendered="#{not empty detEsquelaMB.listaMatriculaEstudiantesMasivosBeanFail}" 
                                             style="width:600px; font-size: 10px;font-size:14px !important;"> 
                                    <f:facet name="header" >
                                        <h:outputText value="Envios Erroneos" />  
                                        <h:commandLink id="cmdImMen" style="float: right;" action="#{detEsquelaMB.imprimirFail()}" target="_blank">
                                            <h:graphicImage value="/resources/images/icons/pdf.png" height="15" />
                                        </h:commandLink>
                                        <p:tooltip for="cmdImMen" value="#{msgs.etiquetaImprimir}" />
                                    </f:facet>
                                    <p:column  headerText="N" filterMatchMode="contains" width="4%" styleClass="siseFontTable3 centrado-texto">
                                        <center>
                                            <h:outputText value="#{n+1}" />
                                        </center>
                                    </p:column>
                                    <p:column headerText="#{msgs.etiquetaCodigo}" filterMatchMode="contains" width="8%" styleClass="siseFontTable3 centrado-texto" sortBy="#{estudiante.estudianteBean.personaBean.idPersona}" >
                                        <h:outputText value="#{estudianteFail.estudianteBean.personaBean.idPersona}"/>
                                    </p:column>
                                    <p:column headerText="#{msgs.etiquetaNombreCompleto}" filterMatchMode="contains" width="20%" styleClass="siseFontTable3 " sortBy="#{estudiante.estudianteBean.personaBean.idPersona}" >
                                        <h:outputText value="#{estudianteFail.estudianteBean.personaBean.nombreCompleto}"/>
                                    </p:column>
                                    <p:column headerText="#{msgs.etiquetaGraAct}" filterMatchMode="contains" width="10%" styleClass="siseFontTable3 centrado-texto" sortBy="#{estudiante.estudianteBean.gradoHabilitado.nombre}" >
                                        <h:outputText value="#{estudianteFail.estudianteBean.gradoHabilitado.nombre}"/>
                                    </p:column>
                                    <p:column headerText="#{msgs.etiquetaSeccAbr}" filterMatchMode="contains" width="5%" styleClass="siseFontTable3 centrado-texto" sortBy="#{estudiante.seccion}" >
                                        <h:outputText value="#{estudianteFail.seccion}"/>
                                    </p:column>
                                    <p:column headerText="#{msgs.etiquetaNro} #{msgs.etiquetaEnvios}s" filterMatchMode="contains" width="5%" styleClass="siseFontTable3 centrado-texto" >
                                        <h:outputText value="#{estudianteFail.cont}" />
                                    </p:column>
                                </p:dataTable>
                            </h:panelGrid>
                        </p:tab>
                    </p:tabView>
                </h:form>  
            </p:dialog>


            <!-- Pop Deuda -->
            <p:dialog id="popDeuda" header="Resumen de Deuda" widgetVar="popDeuda" showEffect="fade" hideEffect="explode"  resizable="false" modal="true" >
                <h:form id="frmPopDeuda" >
                    <h:panelGrid id="pnlPopDeuda" columns="1" >
                        <p:dataTable value="#{detEsquelaMB.listaCuentas}" var="cuenta" rendered="#{not empty detEsquelaMB.listaCuentas}"
                                     paginator="true" paginatorPosition="bottom" rowKey="#{cuenta}" 
                                     style="width: 600px;font-size: 12px;">
                            <f:facet name="header" >
                                <p:outputLabel value="#{msgs.etiquetaDatosGenerales}" />
                            </f:facet>
                            <p:column style="text-align: center;" >
                                <f:facet name="header" >
                                    <p:outputLabel value="#{msgs.etiquetaMes}" />
                                </f:facet>
                                <h:outputText value="#{cuenta.meses}" />
                            </p:column>
                            <p:column style="text-align: center;" >
                                <f:facet name="header" >
                                    <p:outputLabel value="#{msgs.etiquetaConcepto}" />
                                </f:facet>
                                <h:outputText value="#{cuenta.conceptoBean.nombre}" />
                            </p:column>
                            <p:column style="text-align: right;" >
                                <f:facet name="header" >
                                    <p:outputLabel value="#{msgs.etiquetaMonto}" />
                                </f:facet>
                                <h:outputText value="#{cuenta.monto}" >
                                    <f:convertNumber groupingUsed="true" minFractionDigits="2" />
                                </h:outputText>
                            </p:column>
                            <p:columnGroup type="footer">
                                <p:row>
                                    <p:column colspan="2" style="text-align:right" footerText="#{msgs.etiquetaTotal}: " />
                                    <p:column footerText="$#{detEsquelaMB.monto}" style="text-align: right;" >
                                    </p:column>  
                                </p:row>
                            </p:columnGroup>
                        </p:dataTable>
                    </h:panelGrid>
                </h:form>
            </p:dialog>
        </h:body> 
    </ui:define>
</ui:composition>


